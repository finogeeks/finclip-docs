<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="FinClip 运维文档 Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="FinClip 运维文档 Blog Atom Feed"><title data-react-helmet="true">可用性 | FinClip 运维文档</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://devops.finclip.com/docs/ops/availability"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="可用性 | FinClip 运维文档"><meta data-react-helmet="true" name="description" content="&amp;emsp;在互联网业务系统中，高可用是非常重要的一环。为了向用户提供长期稳定的服务，FinClip 在架构设计上便要求所有组件均满足高可用扩展的要求。"><meta data-react-helmet="true" property="og:description" content="&amp;emsp;在互联网业务系统中，高可用是非常重要的一环。为了向用户提供长期稳定的服务，FinClip 在架构设计上便要求所有组件均满足高可用扩展的要求。"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://devops.finclip.com/docs/ops/availability"><link data-react-helmet="true" rel="alternate" href="https://devops.finclip.com/docs/ops/availability" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://devops.finclip.com/docs/ops/availability" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.9e7bfb73.css">
<link rel="preload" href="/assets/js/runtime~main.a3166f89.js" as="script">
<link rel="preload" href="/assets/js/main.a97cd911.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="凡泰极客 - FinClip" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="凡泰极客 - FinClip" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/introduction">运维文档</a><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/finogeeks/finclip-ops-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/introduction">概述</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/requirements">部署要求</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/finclip-ops-architecture">运维架构</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/servicelist">业务组件</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">基础设施</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrastructure/intro">概述</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrastructure/redis">数据缓存</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrastructure/consul">服务治理</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrastructure/mysql">数据存储</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrastructure/minio">文件存储</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrastructure/kafka">消息队列</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrastructure/es">行为数据存储</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">运维管理</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ops/orchestration">服务编排</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ops/monitoring">监控系统</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ops/logging">日志收集</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ops/skywalking">链路跟踪</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/ops/availability">可用性</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ops/scalability">可扩展性</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ops/security">安全性</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ops/performance">性能指标</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>可用性</h1></header><p> 在互联网业务系统中，高可用是非常重要的一环。为了向用户提供长期稳定的服务，FinClip 在架构设计上便要求所有组件均满足高可用扩展的要求。</p><p> 首先，对于基础服务，我们选择业界主流的开源解决方案。在生产环境采用多节点部署，所有基础服务包括Kafka、Mongo、Redis、Consul、ElasticSearch及其他基础服务均采用集群模式部署，以满足高可用要求，在实际运行中，这样的架构设计可以抵抗一定程度的服务器或网络故障。</p><p> 对于 FinClip 服务端程序，我们采用无状态微服务架构。因此，FinClip服务端程序可以采用微服务的高可用最佳实践。通常，我们将 FinClip服务端以多副本的形式运行在容器平台之上，借助容器平台的运维能力，可以实现后端服务的自动故障切换、多副本部署、服务器节点管理等高可用场景需求。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="数据存储mongodb"></a>数据存储（MongoDB）<a class="hash-link" href="#数据存储mongodb" title="Direct link to heading">#</a></h3><p> FinClip 数据存储支持多种数据库。通常，我们采用 MongoDB 作为主要的存储方案，MongoDB 是一个基于分 布式文件存储的数据库，由 C++ 语言编写，旨在为 WEB 应用提供可扩展的高性能数据存储解决方案，且支持多机房部署。在实际部署中，我们使用 MongoDB 的副本集模式，以满足可扩展、高可用的运维需求。</p><p> 在 MongoDB 副本集模式中，MongoDB以两个以上实例部署，其中一个是主节点，其余都是从节点。主节点负责处理客户端请求，从节点实时复制主节点上的数据。主节点记录在其上的所有操作，从节点轮询主节点获取这些操作，然后对自己的数据副本执行这些操作，从而保证从节点的数据与主节点一致。</p><p><img alt="mongo-rs" src="/assets/images/mongo-rs-3c3039e6d0e4e1e8e5b49bbabd09e32e.png"></p><p> 当MongoDB副本集中的从节点发生故障时，不影响业务使用，当MongoDB副本集中的主节点发生故障时，集群将在从节点中进行投票选举出新的主节点，从而实现集群的高可用性和数据安全性。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="数据缓存redis"></a>数据缓存（Redis）<a class="hash-link" href="#数据缓存redis" title="Direct link to heading">#</a></h3><p> FinClip采用 Redis 实现数据缓存。Redis 是一种开源(BSD 许可)、内存中数据结构存储的开源软件，通常 用作数据库、缓存和消息代理。 Redis 提供了诸如字符串、散列、列表、集合、带范围查询的排序集合、位图、 超级日志、地理空间索引和流等数据结构。</p><p> 通常，我们采用集群模式部署Redis，以确保系统实现高可用功能。在这种模式下，Redis存储空间会被分为多个区间，每个区间的数据将被存储在所属的主从实例中。例如：假设我们有 6 台服务器，我们可以部署一个由 3 主 3 从 组成的集群，Redis会将数据分成三个部分并存储其中。</p><p><img alt="redis-cluster" src="/assets/images/redis-cluster-8913d015a67845bc71f486ca446257b0.png"></p><p> 当Reids集群中出现Slave节点宕机时，Redis集群访问不受影响，当集群中出现Master节点宕机时，其对应的从节点将提升为主节点，为业务提供访问，由此实现了Redis集群的高可用性。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="消息队列kafka"></a>消息队列（Kafka）<a class="hash-link" href="#消息队列kafka" title="Direct link to heading">#</a></h3><p> 消息队列中间件是分布式系统中重要的组件,主要解决应用耦合、异步消息、流量削锋等问题。实现高性能、高可用、可伸缩和最终一致性架构。在FinClip架构中，我们选择Apache Kafka作为我们的消息中间件。</p><p> Apache Kafka 是一个开源分布式事件流平台，被数千家 公司用于高性能数据管道、流分析、数据集成和关键任务应用程序。FinClip 采用 Kafka 作为消息队列中间件，基于 Kafka 的多分区设计，可以实现高吞吐量消息队列管理。</p><p><img alt="kafka-cluster" src="/assets/images/kafka-cluster-72b1390a73778461642acca46ef3aeb0.png"></p><p> 在生产部署中，我们采用多节点部署Kafka集群。Kafka利用Zookeeper进行节点选举和管理。在服务内部，Kafka数据根据不同的Topic进行区分，Topic由多个partition组成，这些partition可以设置多个数据副本，这些数据副本保存在不同的机器节点上，当集群内有服务器发生故障时，集群访问将自动切换到相应的副本所在服务器上，从而实现集群服务的高可用性。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="行为数据存储elasticsearch"></a>行为数据存储（ElasticSearch）<a class="hash-link" href="#行为数据存储elasticsearch" title="Direct link to heading">#</a></h3><p> FinClip 采用 ElasticSearch 进行存储、检索和分析用户行为数据。Elasticsearch 是一种分布式 RESTful 搜索和分析引擎，能够处理越来越多的用例。作为 Elastic Stack 的核心，它集中存储数据，以实现闪电般的快速搜索、微调相关性和可轻松扩展的强大分析。</p><p><img alt="es-cluster" src="/assets/images/es-cluster-76f659926f4a0e939824b2b318dce7ae.png"></p><p> ElasticSearch 的主旨是随时可用和按需扩容。 而扩容可以通过购买性能更强大（ 垂直扩容 ，或 纵向扩容 ） 或者数量更多的服务器（ 水平扩容 ，或 横向扩容 ）来实现。</p><p> 在生产环境中，我们采用多节点部署ElasticSearch集群，并设置相应的副本分片，使得数据可以同时存储在多个分散的服务器之上。当数据主分片所在的服务器发生故障时，副分片所在的服务器将继续提供集群服务，从而保证服务的可扩展性和可用性。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="finclip微服务"></a>FinClip微服务<a class="hash-link" href="#finclip微服务" title="Direct link to heading">#</a></h3><p> Finclip后端业务服务采用了微服务框架，每个服务是一个可以独立多实例部署的模块，通常对应于一个工程项目。有以下特性：</p><p>  <strong>服务发现与注册：</strong> 微服务使用了consul组件进行注册与发现，通过consul，可以监控微服务活动状态。</p><p>  <strong>负载均衡：</strong> 结合k8s和consul技术，微服务之间的访问是负载均衡的调用。</p><p>  <strong>可扩展：</strong> 每个服务都是可以多实例部署。</p><p>  <strong>高并发：</strong> 采用了集群模式的redis缓存机制和grpc调用机制，同时技术上使得同一个key分布在多个redis槽，提高redis访问命中率，提高并发程度。</p><p> finclip框架如下：</p><p><img alt="finclip-arch" src="/assets/images/finclip-arch-1874b1dfefe35d2a50b36d66ccb7d4e6.png"></p><p> 系统总体架构上分为网关层、业务服务层、数据层、基础设施层。</p><p> <strong>网关层：</strong> 集成了流量控制、权限控制、负载均衡、网络隔离等功能。</p><p> <strong>业务服务层：</strong> 是业务、需求的实现层。</p><p> <strong>数据层：</strong> 业务或者非业务产生数据，需要落地到db(数据库)，同步到缓存(redis)，发送消息队列(kafka)，文件存储(对象存储)，数据搜索(es)等。</p><p> <strong>基础设施层：</strong> 底层支撑，包括虚拟机操作系统、网络物理层、硬盘等。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/ops/skywalking"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 链路跟踪</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/ops/scalability"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">可扩展性 »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#数据存储mongodb" class="table-of-contents__link">数据存储（MongoDB）</a></li><li><a href="#数据缓存redis" class="table-of-contents__link">数据缓存（Redis）</a></li><li><a href="#消息队列kafka" class="table-of-contents__link">消息队列（Kafka）</a></li><li><a href="#行为数据存储elasticsearch" class="table-of-contents__link">行为数据存储（ElasticSearch）</a></li><li><a href="#finclip微服务" class="table-of-contents__link">FinClip微服务</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items"><li class="footer__item"><a href="https://www.finclip.com/mop/document/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>产品文档<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">运维文档</a></li></ul></div><div class="col footer__col"><div class="footer__title">开发资源</div><ul class="footer__items"><li class="footer__item"><a href="https://www.finclip.com/downloads" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>资源下载中心<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.finclip.com/market" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>小程序应用市场<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/finogeeks" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items"><li class="footer__item"><a href="https://www.finclip.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>FinClip官网<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/blog">运维博客</a></li><li class="footer__item"><a href="https://www.finclip.com/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>产品博客<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 FinoGeeks, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a3166f89.js"></script>
<script src="/assets/js/main.a97cd911.js"></script>
</body>
</html>